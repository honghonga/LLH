/* duba_component 2017-04-06T15:35:08+0800 */
var unitUserTagData,sumUserTagData,tagMap=[],userTag={dayDataHandle:function(obj,testDate){if(this.access){this.clearData();var testCount,type;for(type in obj)if(obj.hasOwnProperty(type)){testCount=obj[type];var curDate=testDate||new Date,curDayData,tagData,i=0,len,date;for(!unitUserTagData[type]&&(unitUserTagData[type]=[{c:0,t:+curDate}]),tagData=unitUserTagData[type],len=tagData.length;len>i;i++)if(tagData[i]&&tagData[i].t&&(date=new Date(tagData[i].t),date.getMonth()==curDate.getMonth()&&date.getDay()==curDate.getDay())){curDayData=tagData[i];break}curDayData?curDayData.c+=void 0!=testCount?testCount:1:tagData.push({c:void 0!=testCount?testCount:1,t:+curDate});var strData=JSON&&JSON.stringify&&JSON.stringify(unitUserTagData)||eval("("+unitUserTagData+")");localStorage.setItem("userTagUnit",strData)}this.clearData()}},sumDataHandle:function(shouldSum){var key,item,len,sum,clear=!1;for(key in sumUserTagData)if(sumUserTagData.hasOwnProperty(key)&&(item=sumUserTagData[key],len=item.length,len>=UtagInfo.sumCircle)){clear=!0;break}for(var _this=this,i=0,len=tagMap.length,key,clearCount;len>i;i++)key=tagMap[i],item=sumUserTagData[key]||(sumUserTagData[key]=[]),clear&&(clearCount=item.length-UtagInfo.sumCircle+(shouldSum?1:0),item.splice(0,clearCount)),shouldSum&&(sum=_this.sum(unitUserTagData[key]||[]),item.push(sum));if(shouldSum){unitUserTagData={};var strData=JSON&&JSON.stringify&&JSON.stringify(unitUserTagData)||eval("("+unitUserTagData+")");localStorage.setItem("userTagUnit",strData)}if(shouldSum||clear){var strData2=JSON&&JSON.stringify&&JSON.stringify(sumUserTagData)||eval("("+sumUserTagData+")");localStorage.setItem("userTagSum",strData2)}},sum:function(a){for(var b,c=0,d=a.length,e=0;d>c;c++)b=a[c].c||0,UtagInfo.maxCount&&(b=b>UtagInfo.maxCount?UtagInfo.maxCount:b),e+=b;return e},clearData:function(){var a,b,c,d,e=new Date,f=0,g=!1;for(a in unitUserTagData)if(unitUserTagData.hasOwnProperty(a)){if(c=unitUserTagData[a],b=c.length,b>=UtagInfo.unitCircle)for(g=!0,f=0;b>f;f++)if(d=new Date(c[f].t),d.getMonth()==e.getMonth()&&d.getDay()==e.getDay()){g=!1;break}if(g)break}this.sumDataHandle(g)},access:!1,init:function(){if(this.access=window.localStorage&&UtagInfo&&UtagInfo.tagMap&&UtagInfo.sumCircle&&UtagInfo.unitCircle,this.access){unitUserTagData=$.parseJSON(localStorage.getItem("userTagUnit")||"{}"),sumUserTagData=$.parseJSON(localStorage.getItem("userTagSum")||"{}");for(var a,b=0,c=UtagInfo.tagMap.length;c>b;b++){a=UtagInfo.tagMap[b];for(var d in a)a.hasOwnProperty(d)&&tagMap.push(d)}this.clearData()}}};